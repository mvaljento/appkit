import{memo as h,useEffect as u,useState as p}from"react";import{Web3ModalSign as m}from"@web3modal/sign-html";import w from"mitt";const g=w();let d;function b(e){d=new m(e)}async function s(){return new Promise(e=>{if(d)e(d);else{const n=setInterval(()=>{d&&(clearInterval(n),e(d))},200)}})}function O(e){return u(()=>{b(e)},[]),null}const A=h(O);function v(){const[e,n]=p(void 0),[t,o]=p(void 0),[r,a]=p(!1);return{data:e,error:t,loading:r,setData:n,setError:o,setLoading:a}}function R(e){const{data:n,error:t,loading:o,setData:r,setError:a,setLoading:c}=v();async function l(f){try{c(!0),a(void 0);const i=await(await s()).connect(f??e);return r(i),g.emit("session_change"),i}catch(i){throw a(i),i}finally{c(!1)}}return{data:n,error:t,loading:o,connect:l}}function $(e){const{error:n,loading:t,setError:o,setLoading:r}=v();async function a(c){try{r(!0),o(void 0),await(await s()).disconnect(c??e),g.emit("session_change")}catch(l){throw o(l),l}finally{r(!1)}}return{error:n,loading:t,disconnect:a}}function E(e){u(()=>(s().then(n=>{n.onSessionDelete(e)}),()=>{s().then(n=>{n.offSessionDelete(e)})}),[e])}function k(e){u(()=>(s().then(n=>{n.onSessionEvent(e)}),()=>{s().then(n=>{n.offSessionEvent(e)})}),[e])}function D(e){u(()=>(s().then(n=>{n.onSessionExpire(e)}),()=>{s().then(n=>{n.offSessionExpire(e)})}),[e])}function j(e){u(()=>(s().then(n=>{n.onSessionUpdate(e)}),()=>{s().then(n=>{n.offSessionUpdate(e)})}),[e])}function z(e){const{data:n,error:t,loading:o,setData:r,setError:a,setLoading:c}=v();async function l(f){try{c(!0),a(void 0);const i=await(await s()).request(f??e);return r(i),i}catch(i){throw a(i),i}finally{c(!1)}}return{data:n,error:t,loading:o,request:l}}var P=Object.defineProperty,M=Object.defineProperties,W=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,x=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,y=(e,n,t)=>n in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,_=(e,n)=>{for(var t in n||(n={}))x.call(n,t)&&y(e,t,n[t]);if(S)for(var t of S(n))L.call(n,t)&&y(e,t,n[t]);return e},q=(e,n)=>M(e,W(n));function B(){const[e,n]=p(void 0);return E(t=>{t.topic===e?.topic&&n(void 0)}),j(t=>{if(e&&t.topic===e?.topic){const{namespaces:o}=t.params,r=q(_({},e),{namespaces:o});n(r)}}),D(t=>{e&&t.topic===e?.topic&&n(void 0)}),u(()=>{async function t(){const o=await(await s()).getSession();n(o)}return t(),g.on("session_change",t),()=>{g.off("session_change",t)}},[]),e}function F(){const[e,n]=p(void 0);return u(()=>{async function t(){const o=await(await s()).getSessions();n(o)}t()},[]),e}export{A as Web3ModalSign,R as useConnect,$ as useDisconnect,E as useOnSessionDelete,k as useOnSessionEvent,D as useOnSessionExpire,j as useOnSessionUpdate,z as useRequest,B as useSession,F as useSessions};
